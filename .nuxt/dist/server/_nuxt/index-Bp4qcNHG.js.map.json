{"file":"index-Bp4qcNHG.js","mappings":"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","names":["_push","_parent","_","_scopeId","_createVNode","_ssrRenderComponent","_createBlock"],"sources":["../../../../pages/index.vue"],"sourcesContent":["<template>\n\t<v-container\n\t\tclass=\"d-flex flex-column align-center justify-center\"\n\t\tstyle=\"min-height: 70vh\">\n\t\t<v-btn\n\t\t\tv-if=\"!isScanning\"\n\t\t\tclass=\"d-flex align-center justify-center flex-column ga-2\"\n\t\t\tstyle=\"width: 20em; height: 20em; border: 2px dashed #ccc\"\n\t\t\tvariant=\"text\"\n\t\t\t@click=\"startScan\">\n\t\t\t<div\n\t\t\t\tclass=\"d-flex flex-column align-center justify-center w-100 h-100 ga-4\">\n\t\t\t\t<v-icon\n\t\t\t\t\tsize=\"128\"\n\t\t\t\t\tcolor=\"primary\"\n\t\t\t\t\ticon=\"mdi-barcode-scan\" />\n\t\t\t\t<span class=\"text-h6 font-medium\">點擊開始掃描 ISBN</span>\n\t\t\t</div>\n\t\t</v-btn>\n\n\t\t<v-card\n\t\t\tv-else\n\t\t\tclass=\"w-100\"\n\t\t\tmax-width=\"500\"\n\t\t\televation=\"4\">\n\t\t\t<v-toolbar\n\t\t\t\tcolor=\"primary\"\n\t\t\t\tdensity=\"compact\">\n\t\t\t\t<v-toolbar-title>正在讀取條碼...</v-toolbar-title>\n\t\t\t\t<v-spacer></v-spacer>\n\t\t\t\t<v-btn\n\t\t\t\t\ticon=\"mdi-close\"\n\t\t\t\t\t@click=\"stopScan\"></v-btn>\n\t\t\t</v-toolbar>\n\n\t\t\t<div\n\t\t\t\tid=\"scanner\"\n\t\t\t\tclass=\"w-100\"></div>\n\n\t\t\t<v-card-text class=\"text-center\">\n\t\t\t\t<v-chip\n\t\t\t\t\tprepend-icon=\"mdi-information\"\n\t\t\t\t\tvariant=\"text\">\n\t\t\t\t\t請將書籍背面的 ISBN 條碼對準對焦框\n\t\t\t\t</v-chip>\n\t\t\t</v-card-text>\n\t\t</v-card>\n\t</v-container>\n</template>\n\n<script setup>\n\timport { ref, nextTick } from 'vue';\n\timport { Html5QrcodeScanner } from 'html5-qrcode';\n\timport isbn from 'isbn3';\n\timport { useIsbnStore } from '~/stores/isbnStore';\n\n\tconst isbnStore = useIsbnStore();\n\tconst isScanning = ref(false);\n\tlet scannerInstance = null; // 用來存放掃描器實例\n\n\t// 啟動掃描\n\tconst startScan = async () => {\n\t\tisScanning.value = true;\n\n\t\t// 重要：等待 Vue 完成 DOM 渲染，確保 #scanner 已經在 template 中出現\n\t\tawait nextTick();\n\n\t\tscannerInstance = new Html5QrcodeScanner('scanner', {\n\t\t\tfps: 10,\n\t\t\tqrbox: { width: 280, height: 180 }, // 針對長條形 ISBN 調整\n\t\t});\n\n\t\tscannerInstance.render((barcode) => {\n\t\t\t// 驗證 ISBN\n\t\t\tconst parsed = isbn.parse(barcode);\n\t\t\tif (parsed) {\n\t\t\t\t// 1. 存入 Store (會自動處理重複與流水號)\n\t\t\t\tisbnStore.addResult(parsed.isbn13);\n\n\t\t\t\t// 2. 停止掃描並釋放相機\n\t\t\t\tstopScan();\n\n\t\t\t\t// 3. 成功後自動跳轉到清單頁面\n\t\t\t\tnavigateTo('/list');\n\t\t\t}\n\t\t});\n\t};\n\n\t// 停止並清除掃描器\n\tconst stopScan = () => {\n\t\tif (scannerInstance) {\n\t\t\tscannerInstance.clear(); // 清除 html5-qrcode 產生的 DOM\n\t\t\tscannerInstance = null;\n\t\t}\n\t\tisScanning.value = false;\n\t};\n</script>\n"],"version":3}